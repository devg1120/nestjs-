

https://prisma.io/docs/guides/nestjs

npm install -g @nestjs/cli
nest new nestjs-prisma
cd nestjs-prisma

vi package.json
{
  "type": "module"
}

vi docker-compose.yml 
version: "3.7"
services:
  db:
    container_name: postgres
    image: postgres:13
    ports:
      - "5432:5432"
    # Make postgres logs. More information about logging, see official documentation: https://www.postgresql.org/docs/11/runtime-config-logging.html
    command: postgres -c log_destination=stderr -c log_statement=all -c log_connections=on -c log_disconnections=on
    environment:
      - POSTGRES_PASSWORD=postgres
    logging:
      options:
        max-size: "10k"
        max-file: "5"


docker compose up -d

npm install prisma --save-dev
npm install @prisma/client @prisma/adapter-pg pg
npx prisma init --datasource-provider postgresql --output ../src/generated/prisma

vi prisma/schema.prisma
---
model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
  posts Post[]
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  published Boolean? @default(false)
  author    User?    @relation(fields: [authorId], references: [id])
  authorId  Int?
}
---

npx prisma migrate dev --name init

psql -h 127.0.0.1  -U postgres

# \c mydb;
# \d
# select * from "User";
# select * from "Post";

npx prisma generate

src/app_module.ts
  import { AppController } from './app.controller';
  ->
  import { AppController } from './app.controller.js';

src/main.ts
  import { AppModule } from './app.module';
  ->
  import { AppModule } from './app.module.js';


npx tsx script.ts

npm start

